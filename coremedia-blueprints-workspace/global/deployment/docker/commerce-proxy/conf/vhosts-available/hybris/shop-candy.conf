<VirtualHost *:80 >
  ServerName candy-shop-preview-hybris.${ENVIRONMENT_FQDN}
  ServerAlias candy-shop-hybris.${ENVIRONMENT_FQDN}

  SetEnvIfNoCase Host candy-shop-preview-hybris.${ENVIRONMENT_FQDN} caeport=40980
  SetEnvIfNoCase Host candy-shop-hybris.${ENVIRONMENT_FQDN} caeport=42180

  RewriteEngine On
  ProxyPreserveHost On
  Header unset X-Frame-Options

  SSLProxyEngine On
  SSLProxyVerify none
  SSLProxyCheckPeerCN off
  SSLProxyCheckPeerName off

  # extract the IP from Traefik to inject it into the fragmenthost header
  RemoteIPHeader X-REAL-IP
  SetEnvIf X-REAL-IP "(.*)" devaddr=$1
  SetEnvIF X-REAL-IP "(172.*)" devaddr=${ENVIRONMENT_FQDN}

  # in a production setup we pin the fragment host to the live CAE for all development setups, one WCS instance
  # should suffice by using the X-FragmentHostDevelopment config below
  # development setup
  RequestHeader set X-FragmentHostDevelopment http://%{devaddr}e:%{caeport}e/blueprint/servlet/service/fragment/

  RewriteCond %{REQUEST_FILENAME} !yacceleratorstorefront/
  RewriteCond %{REQUEST_FILENAME} !medias/
  RewriteRule .* - [F]

  # Hybris stores  pass through for preview
  ProxyPass / https://${HYBRIS_HOST}:9002/ timeout=600 nocanon

</VirtualHost>
